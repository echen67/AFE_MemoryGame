<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" href="css/wordFindStyle.css">
    <meta charset="UTF-8">
    <title>File Upload</title>
    <script type="text/javascript" src="js/localStorage.js"></script>
    <noscript>alert('Sorry, your browser does not support JavaScript!');</noscript>
    <script type="text/javascript">

    var array_to_store;
    var name_to_store = "Name";

    // singular file uploads
        function selectFile() {
            var file = document.getElementById('list').files[0];
            var textType = /text.*/;
            if(!file.type.match(textType)) {
                alert('Please select a word list saved as a .txt file.');
            } else {
                var s = 'Name: ' + file.name;
                s += '<br>Type: ' + file.type;
                s += '<br>Size: ' + file.size;
                file.openFile(event);
                s += "<br>====================================<br>"
                document.getElementById('fileDetails').innerHTML = s;
            }
        }

        // multiple file uploads
        function selectFiles() {
            var fileUps = document.getElementById('lists').files;
            var s = 'Number of files: ' + fileUps.length + '<br>';
            for (i =0; i < fileUps.length; i++) {
                var file = fileUps[i];
                var textType = /text.*/;
                if(!file.type.match(textType)) {
                    alert(file.name + ' is not a valid file type. Please select a word list saved as a .txt file.');
                } else {
                    s += 'Name: ' + file.name;
                    s += '<br>Type: ' + file.type;
                    s += '<br>Size: ' + file.size;
                    s += "<br>===================================="
                }
            }
            document.getElementById('fileDetails').innerHTML = s;
        }

        var openFile = function(event) {
            // ERROR Prevention: Check for the various File API support.
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                // Great success! All the File APIs are supported.
                var input = event.target;
                var reader = new FileReader();
                reader.onload = function(){
                  var text = reader.result; // contains all textual content from file
                  //NEW NICOLE
                  var tostore_pre = text.replace( /\n/g, " " ); //replace all newlines with spaces
                  var tostore = tostore_pre.split(" "); //store each word as entry in new array
                  console.log("original array");
                  console.log(tostore);


                  //error checking for special characters
                  var curr_word;
                  for (var i = 0; i < tostore.length; i++) {
                    curr_word = tostore[i];
                    if (curr_word.indexOf('!') > -1 | curr_word.indexOf('*') > -1 | curr_word.indexOf('&') > -1 | curr_word.indexOf('#') > -1 | curr_word.indexOf('@') > -1 | curr_word.indexOf('~') > -1 | curr_word.indexOf('"') > -1 | curr_word.indexOf('^') > -1 | curr_word.indexOf('%') > -1 | curr_word.indexOf('(') > -1 | curr_word.indexOf(')') > -1) {
                        tostore.splice(i, 1); //remove word from list
                        i = i - 1; //adjust for new array length
                        alert("There was a special character in your word list. This word will not be included in the puzzle.");
                    }
                  }

                  array_to_store = tostore; //set global var
                  console.log("Array_to_store");
                  console.log(array_to_store);
                  //END NEW NICOLE
                };
                reader.readAsText(input.files[0]);
            } else {
              alert('The File APIs are not fully supported in this browser.');
            }

        };

        // ---------------------------------------- BUTTON NAVIGATION
        function upload(){
            name_to_store = document.getElementById('displayN').value; //take file name from "List Display Name" textbox
            if (array_to_store.length > 1) { //error checking for empty list
                localStorage.setItem(name_to_store, array_to_store); //use global vars to save in loc storage
                console.log("accessing local storage...");
                //console.log(localStorage.getItem(name_to_store)[0]);
                console.log(localStorage.getItem(name_to_store));
                alert("list creation success");
            } else {
                alert("The selected list is empty! No puzzle can be created.");
            }
            //window.location.href = "home.html";
        }
        
        function back(){
            window.location.href = "home.html";
        }
        function help(){
            window.location.href = "uploadHelp.html";
        }
        function makeCustomList(){
            window.location.href = "customList.html";
        }
    </script>
</head>

<body>
	<div class = "headingBox">
		<h3 class = "heading">Word Find</h3>
    </div>
   
	<!-- Tabs on the right left -->
    <button class = "fileUploadTab" style = "background-color: rgb(223, 251,251)">File Upload</button>
    <button class = "customListTab" style = "background-color: rgb(141, 182, 182)" onclick = "makeCustomList()">Create Custom List</button>
	<div class = "tabHider"></div>
    
    <div class = "screenBody">
		<h4 class = "pageTitle">Create New Word List: Upload File</h4>
		<form class = "inputForm">
			List Display Name:  <input type = "text" id = "displayN" value = "">
			<br>
			<br>
			File Select:  <input type = "file" accept = 'text/plain' id = "uploadFile" onchange='openFile(event)'>
		</form>
		<!-- BUTTONS -->
		<!-- TODO: multiple file uploads -->
	</div>
	<button class = "puzzleSaveButton" onclick = "upload()">UPLOAD</button>
	<button class = "homeButton" onclick = "back()">Home</button>
	<button class = "helpButton" onclick = "help()">Help</button>
</body>
</html>